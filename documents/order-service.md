## Order Service: правила и соглашения

См. также `documents/common-rules.md` для общих принципов. Ниже — специфичные правила для сервиса.

### Назначение
Управление заказами, синхронизация статусов, генерация событий в Kafka, gRPC-запросы к продуктам.

### Слои
- Controller: REST-контракты (создание, поиск, анализ), без бизнес-логики.
- Service: обработка заказов, применение бизнес-правил, публикация событий.
- Repository: доступ к БД (orders schema).

### Безопасность
- Все запросы проходят проверку через Jwt (ownerUserId и companyId). Проверять принадлежность заказов.

### Интеграции
- GRPC к продуктам (см. `ProductGrpcClientConfig`).
- Kafka продюсеры: `OrderEventProducer` (создание/отмена и т.д.).
- Консьюмеры событий (при необходимости) — держать идемпотентность.

### Сущности
- `Order`, `OrderItem`, `OrderStatusHistory` — каскад ALL для items, orphanRemoval true.

### Миграции
- Все изменения через Flyway, существующие V1..V11.

### Логирование
- Info: ключевые операции заказа. Error: сбои интеграций/БД. Debug: детали запросов без чувствительных данных.


